// APP ARTICLE SLIDER
// AUTHOR BRENTON KELLY - WEB DEVELOPMENT MANAGER - BLACKBOARD, INC.
// VERSION 03.08.19

!function(d){d.fn.csArticleSlider=function(e){var c={viewerNum:[4,3,3,2,1],transitionSpeed:.3,slideFullView:!1,extend:function(e,i,t){}};return e&&d.extend(c,e),this.each(function(){var l=this,e={pmi:d(l).closest("div[id*='pmi-']").attr("id").replace("pmi-",""),articleNum:0,articleWidth:0,sliderPosition:0,slider:".ui-articles",article:".ui-articles > li",sliderIsAnimating:!1,keyCodes:{tab:9,enter:13,esc:27,space:32,end:35,home:36,left:37,up:38,right:39,down:40},Init:function(){var e=this;this.BuildStyleSheet(),this.SetProperties(),this.BuildStructure(),this.UpdateAttributes({updateNotification:!1}),this.Events(),d(window).resize(function(){e.WindowResize()}),d(window).load(function(){e.SetProperties()})},SetProperties:function(){this.articleNum=d(this.article,l).length,this.articleWidth=d(this.article+":first-child",l).outerWidth(!0)},WindowResize:function(){var e=this.GetBreakPoint();this.articleWidth=d(this.article+":first-child",l).outerWidth(!0),d(this.article,l).attr("aria-hidden","false"),this.UpdateAttributes({updateNotification:!1}),this.articleNum>e.viewNum?d(".cs-article-slider-control",l).attr("aria-hidden","false"):d(".cs-article-slider-control",l).attr("aria-hidden","true")},BuildStructure:function(){var e=this.GetBreakPoint();d(this.article,l).each(function(e){d(this).attr("data-index",e)}),d(this.slider,l).css("left","0px").wrap('<div class="cs-article-slider"><div class="cs-article-viewer"></div></div>'),d(".cs-article-slider",l).prepend('<a href="#" role="button" aria-label="Cycle Articles Backward" class="cs-article-slider-control back" aria-hidden="'+(this.articleNum>e.viewNum?"false":"true")+'"></a>'),d(".cs-article-slider",l).append('<a href="#" role="button" aria-label="Cycle Articles Forward" class="cs-article-slider-control next" aria-hidden="'+(this.articleNum>e.viewNum?"false":"true")+'"></a>'),d(".ui-widget-detail",l).append('<div class="cs-article-slider-notifications cs-ally-hidden" aria-live="polite"></div>')},Events:function(){var i=this,t=this.GetBreakPoint();d(l).on("click keydown",".cs-article-slider-control",function(e){i.AllyClick(e)&&(e.preventDefault(),i.sliderIsAnimating||(i.sliderIsAnimating=!0,i.articleWidth=d(i.article+":first-child",l).outerWidth(!0),d(i.article,l).attr("aria-hidden","false"),d(this).hasClass("back")?i.AnimateSlider({direction:"back"}):i.AnimateSlider({direction:"next"})))}),d(l).on("swiperight",".cs-article-slider",function(e){!i.sliderIsAnimating&&i.articleNum>t.viewNum&&(i.sliderIsAnimating=!0,i.articleWidth=d(i.article+":first-child",l).outerWidth(!0),d(i.article,l).attr("aria-hidden","false"),i.AnimateSlider({direction:"back"}))}),d(l).on("swipeleft",".cs-article-slider",function(e){!i.sliderIsAnimating&&i.articleNum>t.viewNum&&(i.sliderIsAnimating=!0,i.articleWidth=d(i.article+":first-child",l).outerWidth(!0),d(i.article,l).attr("aria-hidden","false"),i.AnimateSlider({direction:"next"}))})},AnimateSlider:function(e){var i=this,t=this.GetBreakPoint(),n=0,r=0;if(c.slideFullView&&(n=this.articleNum-t.viewNum,(r=t.viewNum-n)<0&&(r=0)),"back"==e.direction){if(this.sliderPosition=c.slideFullView?this.sliderPosition-this.articleWidth*t.viewNum:this.sliderPosition-this.articleWidth,d(this.slider,l).css("left",this.sliderPosition),c.slideFullView){for(var s=this.articleNum-t.viewNum>t.viewNum?t.viewNum:this.articleNum-t.viewNum,o=1;o<=s;o++)d(this.slider,l).prepend(d(this.article+":last-child",l));if(0<r)for(var a=1;a<=r;a++)d(this.slider,l).prepend(d(this.article+":nth-child("+this.articleNum+")",l).clone().addClass("article-clone"))}else d(this.slider,l).prepend(d(this.article+":last-child",l));this.sliderPosition=c.slideFullView?this.sliderPosition+this.articleWidth*t.viewNum:this.sliderPosition+this.articleWidth,d(this.slider,l).animate({left:this.sliderPosition},1e3*c.transitionSpeed,function(){if(c.slideFullView&&(d(i.article+".article-clone",l).remove(),0<r))for(var e=1;e<=r;e++)d(i.slider,l).prepend(d(i.article+":last-child",l));i.UpdateAttributes({updateNotification:!0}),i.sliderIsAnimating=!1})}else if("next"==e.direction){if(this.sliderPosition=c.slideFullView?this.sliderPosition-this.articleWidth*t.viewNum:this.sliderPosition-this.articleWidth,c.slideFullView&&0<r)for(a=1;a<=r;a++)d(this.slider,l).append(d(this.article+":nth-child("+a+")",l).clone().addClass("article-clone"));d(this.slider,l).animate({left:this.sliderPosition},1e3*c.transitionSpeed,function(){i.sliderPosition=c.slideFullView?i.sliderPosition+i.articleWidth*t.viewNum:i.sliderPosition+i.articleWidth,c.slideFullView?(d(i.article+".article-clone",l).remove(),d(i.slider,l).css("left",i.sliderPosition).append(d(i.article+":nth-child(-n+"+t.viewNum+")",l))):d(i.slider,l).css("left",i.sliderPosition).append(d(i.article+":first-child",l)),i.UpdateAttributes({updateNotification:!0}),i.sliderIsAnimating=!1})}},UpdateAttributes:function(e){var i=this.GetBreakPoint();if(d(this.article+":nth-of-type(n+"+(i.viewNum+1)+")",l).attr("aria-hidden","true"),e.updateNotification){var t="";d(this.article+"[aria-hidden='false']",l).each(function(e){0!=e&&(e==i.viewNum-1?t+=", and ":t+=", "),t+=parseInt(d(this).attr("data-index"))+1}),d(".cs-article-slider-notifications",l).text("Articles "+t+" are currently in view.")}},GetBreakPoint:function(){switch(window.getComputedStyle(document.querySelector("body"),":before").getPropertyValue("content").replace(/"|'/g,"")){case"desktop":return{viewPort:960,viewNum:c.viewerNum[0]};case"768":return{viewPort:768,viewNum:c.viewerNum[1]};case"640":return{viewPort:640,viewNum:c.viewerNum[2]};case"480":return{viewPort:480,viewNum:c.viewerNum[3]};case"320":return{viewPort:320,viewNum:c.viewerNum[4]}}},AllyClick:function(e){return"click"==e.type||"keydown"==e.type&&(e.keyCode==this.keyCodes.space||e.keyCode==this.keyCodes.enter)},BuildStyleSheet:function(){var e=document.createElement("style");if(e){e.setAttribute("type","text/css");var i=document.getElementsByTagName("head")[0];i&&i.insertBefore(e,i.childNodes[0]);var t='body:before {content: "desktop";display: none;}#pmi-'+this.pmi+" .cs-ally-hidden {width: 0 !important;height: 0 !important;display: inline-block !important;padding: 0 !important;margin: 0 !important;border: 0 !important;overflow: hidden !important;}#pmi-"+this.pmi+" .ui-widget.app .cs-article-viewer {position: relative;overflow: hidden;-webkit-flex: 1 1 auto;-ms-flex: 1 1 auto;flex: 1 1 auto;}#pmi-"+this.pmi+" .ui-widget.app .cs-article-slider {display: -ms-flexbox;display: -webkit-flex;display: flex;-webkit-align-items: center;-ms-flex-align: center;align-items: center;}#pmi-"+this.pmi+" .ui-widget.app .ui-articles {display: -ms-flexbox;display: -webkit-flex;display: flex;position: relative;}#pmi-"+this.pmi+" .ui-widget.app .ui-articles > li {width: "+100/c.viewerNum[0]+"%;-webkit-flex: none;-ms-flex: none;flex: none;-webkit-box-sizing: border-box;-moz-box-sizing: border-box;box-sizing: border-box;}#pmi-"+this.pmi+' .ui-widget.app .ui-articles > li[aria-hidden="true"] {visibility: hidden;}#pmi-'+this.pmi+" .ui-widget.app .cs-article-slider-control {width: 35px;height: 35px;display: block;background: #CCC;display: -ms-flexbox;display: -webkit-flex;display: flex;-webkit-align-items: center;-ms-flex-align: center;align-items: center;-webkit-justify-content: center;-ms-flex-pack: center;justify-content: center;-webkit-flex: none;-ms-flex: none;flex: none;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;}#pmi-"+this.pmi+" .ui-widget.app .cs-article-slider-control.back {margin-right: 10px;}#pmi-"+this.pmi+' .ui-widget.app .cs-article-slider-control.back:before {content: "<"}#pmi-'+this.pmi+" .ui-widget.app .cs-article-slider-control.next {margin-left: 10px;}#pmi-"+this.pmi+' .ui-widget.app .cs-article-slider-control.next:before {content: ">"}#pmi-'+this.pmi+" .ui-widget.app .cs-article-slider-control.back:before,#pmi-"+this.pmi+' .ui-widget.app .cs-article-slider-control.next:before {font-size: 18px;font-weight: normal;font-family: "Trebuchet MS", sans-serif;color: #000;line-height: 1;}#pmi-'+this.pmi+' .ui-widget.app .cs-article-slider-control[aria-hidden="true"] {display: none;}@media (max-width: 1023px) {body:before {content: "768";}#pmi-'+this.pmi+" .ui-widget.app .ui-articles > li {width: "+100/c.viewerNum[1]+'%;}}@media (max-width: 767px) {body:before {content: "640";}#pmi-'+this.pmi+" .ui-widget.app .ui-articles > li {width: "+100/c.viewerNum[2]+'%;}}@media (max-width: 639px) {body:before {content: "480";}#pmi-'+this.pmi+" .ui-widget.app .ui-articles > li {width: "+100/c.viewerNum[3]+'%;}}@media (max-width: 479px) {body:before {content: "320";}#pmi-'+this.pmi+" .ui-widget.app .ui-articles > li {width: "+100/c.viewerNum[4]+"%;}}",n=document.createTextNode(t);e.styleSheet?e.styleSheet.cssText=t:e.appendChild(n)}}};c.extend.call(this,c,l,e),d(".ui-articles > li",l).length&&e.Init()})}}(jQuery),function(i,t,n){"function"==typeof define&&define.amd?define(["jquery"],function(e){return n(e,i,t),e.mobile}):n(i.jQuery,i,t)}(this,document,function(e,i,n,t){var r,s;(function(p,e,i,h){function m(e){for(;e&&void 0!==e.originalEvent;)e=e.originalEvent;return e}function s(e){for(var i,t,n={};e;){for(t in i=p.data(e,y))i[t]&&(n[t]=n.hasVirtualBinding=!0);e=e.parentNode}return n}function r(){F=!0}function o(){F=!1}function a(){l(),D=setTimeout(function(){Y=D=0,E.length=0,B=!1,r()},p.vmouse.resetTimerDuration)}function l(){D&&(clearTimeout(D),D=0)}function c(e,i,t){var n;return(t&&t[e]||!t&&function(e,i){for(var t;e;){if((t=p.data(e,y))&&(!i||t[i]))return e;e=e.parentNode}return null}(i.target,e))&&(n=function(e,i){var t,n,r,s,o,a,l,c,d,u=e.type;if((e=p.Event(e)).type=i,t=e.originalEvent,n=p.event.props,-1<u.search(/^(mouse|click)/)&&(n=S),t)for(l=n.length;l;)e[s=n[--l]]=t[s];if(-1<u.search(/mouse(down|up)|click/)&&!e.which&&(e.which=1),-1!==u.search(/^touch/)&&(u=(r=m(t)).touches,o=r.changedTouches,a=u&&u.length?u[0]:o&&o.length?o[0]:h))for(c=0,d=P.length;c<d;c++)e[s=P[c]]=a[s];return e}(i,e),p(i.target).trigger(n)),n}function d(e){var i,t=p.data(e.target,N);!B&&(!Y||Y!==t)&&((i=c("v"+e.type,e))&&(i.isDefaultPrevented()&&e.preventDefault(),i.isPropagationStopped()&&e.stopPropagation(),i.isImmediatePropagationStopped()&&e.stopImmediatePropagation()))}function u(e){var i,t,n,r=m(e).touches;r&&1===r.length&&((t=s(i=e.target)).hasVirtualBinding&&(Y=X++,p.data(i,N,Y),l(),o(),C=!1,n=m(e).touches[0],I=n.pageX,W=n.pageY,c("vmouseover",e,t),c("vmousedown",e,t)))}function f(e){F||(C||c("vmousecancel",e,s(e.target)),C=!0,a())}function v(e){if(!F){var i=m(e).touches[0],t=C,n=p.vmouse.moveDistanceThreshold,r=s(e.target);(C=C||Math.abs(i.pageX-I)>n||Math.abs(i.pageY-W)>n)&&!t&&c("vmousecancel",e,r),c("vmousemove",e,r),a()}}function w(e){if(!F){r();var i,t,n=s(e.target);c("vmouseup",e,n),C||(i=c("vclick",e,n))&&i.isDefaultPrevented()&&(t=m(e).changedTouches[0],E.push({touchID:Y,x:t.clientX,y:t.clientY}),B=!0),c("vmouseout",e,n),C=!1,a()}}function g(e){var i,t=p.data(e,y);if(t)for(i in t)if(t[i])return!0;return!1}function b(){}function t(t){var n=t.substr(1);return{setup:function(){g(this)||p.data(this,y,{}),p.data(this,y)[t]=!0,A[t]=(A[t]||0)+1,1===A[t]&&V.bind(n,d),p(this).bind(n,b),M&&(A.touchstart=(A.touchstart||0)+1,1===A.touchstart&&V.bind("touchstart",u).bind("touchend",w).bind("touchmove",v).bind("scroll",f))},teardown:function(){--A[t],A[t]||V.unbind(n,d),M&&(--A.touchstart,A.touchstart||V.unbind("touchstart",u).unbind("touchmove",v).unbind("touchend",w).unbind("scroll",f));var e=p(this),i=p.data(this,y);i&&(i[t]=!1),e.unbind(n,b),g(this)||e.removeData(y)}}}var x,n,y="virtualMouseBindings",N="virtualTouchID",k="vmouseover vmousedown vmousemove vmouseup vclick vmouseout vmousecancel".split(" "),P="clientX clientY pageX pageY screenX screenY".split(" "),T=p.event.mouseHooks?p.event.mouseHooks.props:[],S=p.event.props.concat(T),A={},D=0,I=0,W=0,C=!1,E=[],B=!1,F=!1,M="addEventListener"in i,V=p(i),X=1,Y=0;for(p.vmouse={moveDistanceThreshold:10,clickDistanceThreshold:10,resetTimerDuration:1500},n=0;n<k.length;n++)p.event.special[k[n]]=t(k[n]);M&&i.addEventListener("click",function(e){var i,t,n,r,s,o=E.length,a=e.target;if(o)for(i=e.clientX,t=e.clientY,x=p.vmouse.clickDistanceThreshold,n=a;n;){for(r=0;r<o;r++)if(s=E[r],0,n===a&&Math.abs(s.x-i)<x&&Math.abs(s.y-t)<x||p.data(n,N)===s.touchID)return e.preventDefault(),void e.stopPropagation();n=n.parentNode}},!0)})(e,0,n),e.mobile={},s={touch:"ontouchend"in n},(r=e).mobile.support=r.mobile.support||{},r.extend(r.support,s),r.extend(r.mobile.support,s),function(c,s,o){function d(e,i,t,n){var r=t.type;t.type=i,n?c.event.trigger(t,o,e):c.event.dispatch.call(e,t),t.type=r}var u=c(n),e=c.mobile.support.touch,a="touchmove scroll",t=e?"touchstart":"mousedown",l=e?"touchend":"mouseup",p=e?"touchmove":"mousemove";c.each("touchstart touchmove touchend tap taphold swipe swipeleft swiperight scrollstart scrollstop".split(" "),function(e,i){c.fn[i]=function(e){return e?this.bind(i,e):this.trigger(i)},c.attrFn&&(c.attrFn[i]=!0)}),c.event.special.scrollstart={enabled:!0,setup:function(){function i(e,i){d(r,(t=i)?"scrollstart":"scrollstop",e)}var t,n,r=this;c(r).bind(a,function(e){c.event.special.scrollstart.enabled&&(t||i(e,!0),clearTimeout(n),n=setTimeout(function(){i(e,!1)},50))})},teardown:function(){c(this).unbind(a)}},c.event.special.tap={tapholdThreshold:750,emitTapOnTaphold:!0,setup:function(){var o=this,a=c(o),l=!1;a.bind("vmousedown",function(e){function i(){clearTimeout(r)}function t(){i(),a.unbind("vclick",n).unbind("vmouseup",i),u.unbind("vmousecancel",t)}function n(e){t(),l||s!==e.target?l&&e.preventDefault():d(o,"tap",e)}if(l=!1,e.which&&1!==e.which)return!1;var r,s=e.target;a.bind("vmouseup",i).bind("vclick",n),u.bind("vmousecancel",t),r=setTimeout(function(){c.event.special.tap.emitTapOnTaphold||(l=!0),d(o,"taphold",c.Event("taphold",{target:s}))},c.event.special.tap.tapholdThreshold)})},teardown:function(){c(this).unbind("vmousedown").unbind("vclick").unbind("vmouseup"),u.unbind("vmousecancel")}},c.event.special.swipe={scrollSupressionThreshold:30,durationThreshold:1e3,horizontalDistanceThreshold:30,verticalDistanceThreshold:30,getLocation:function(e){var i=s.pageXOffset,t=s.pageYOffset,n=e.clientX,r=e.clientY;return 0===e.pageY&&Math.floor(r)>Math.floor(e.pageY)||0===e.pageX&&Math.floor(n)>Math.floor(e.pageX)?(n-=i,r-=t):(r<e.pageY-t||n<e.pageX-i)&&(n=e.pageX-i,r=e.pageY-t),{x:n,y:r}},start:function(e){var i=e.originalEvent.touches?e.originalEvent.touches[0]:e,t=c.event.special.swipe.getLocation(i);return{time:(new Date).getTime(),coords:[t.x,t.y],origin:c(e.target)}},stop:function(e){var i=e.originalEvent.touches?e.originalEvent.touches[0]:e,t=c.event.special.swipe.getLocation(i);return{time:(new Date).getTime(),coords:[t.x,t.y]}},handleSwipe:function(e,i,t,n){if(i.time-e.time<c.event.special.swipe.durationThreshold&&Math.abs(e.coords[0]-i.coords[0])>c.event.special.swipe.horizontalDistanceThreshold&&Math.abs(e.coords[1]-i.coords[1])<c.event.special.swipe.verticalDistanceThreshold){var r=e.coords[0]>i.coords[0]?"swipeleft":"swiperight";return d(t,"swipe",c.Event("swipe",{target:n,swipestart:e,swipestop:i}),!0),d(t,r,c.Event(r,{target:n,swipestart:e,swipestop:i}),!0),!0}return!1},eventInProgress:!1,setup:function(){var e,s=this,i=c(s),o={};(e=c.data(this,"mobile-events"))||(e={length:0},c.data(this,"mobile-events",e)),e.length++,(e.swipe=o).start=function(e){if(!c.event.special.swipe.eventInProgress){c.event.special.swipe.eventInProgress=!0;var i,t=c.event.special.swipe.start(e),n=e.target,r=!1;o.move=function(e){t&&!e.isDefaultPrevented()&&(i=c.event.special.swipe.stop(e),r||(r=c.event.special.swipe.handleSwipe(t,i,s,n))&&(c.event.special.swipe.eventInProgress=!1),Math.abs(t.coords[0]-i.coords[0])>c.event.special.swipe.scrollSupressionThreshold&&e.preventDefault())},o.stop=function(){r=!0,c.event.special.swipe.eventInProgress=!1,u.off(p,o.move),o.move=null},u.on(p,o.move).one(l,o.stop)}},i.on(t,o.start)},teardown:function(){var e,i;(e=c.data(this,"mobile-events"))&&(i=e.swipe,delete e.swipe,e.length--,0===e.length&&c.removeData(this,"mobile-events")),i&&(i.start&&c(this).off(t,i.start),i.move&&u.off(p,i.move),i.stop&&u.off(l,i.stop))}},c.each({scrollstop:"scrollstart",taphold:"tap",swipeleft:"swipe.left",swiperight:"swipe.right"},function(e,i){c.event.special[e]={setup:function(){c(this).bind(i,c.noop)},teardown:function(){c(this).unbind(i)}}})}(e,this)});